<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Card Scraper</title>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0">
    <meta name="author" content="Robert Chen">
    <style>
      body {
        display: flex;
        justify-content: center;
        text-align: center;

        background-color: #eee;
      }
      body, html{
        height: 100%;
        width: 100%;
        margin: 0;
      }
      *{
        font-family: Trebuchet MS, sans-serif;
      }
      #results{
        padding: 25px;
      }
      #search-box{
        border: 1px solid #ddd;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        outline: none;
        
        border-radius: 15px;
      }
      #search-box:focus{
        border: 1px solid #888;
      }
      
      .disabled{
        display: none;
      }
      
      /* From material.io */
      .download{
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAQAAABIkb+zAAAEzklEQVR4Ae2aU4BsSQyGc23b4+4dnD71Z23btm3btvdlbdu2bdu719boGqnq00rjob48TSPJf0qpTJMaHo/H4/F4PB6Px9OWgaPwGD7A9/iPGzGFf8LreBDX4kiOUykT9ja74zFM5pYI+wlXYm1qT6WG2RbP8mx30rbhf5xnhpZO8svyu9ySsc3GvWZZKjZ1fXE7t2RvuLOqJxUPsxGP5pbcDH/yqlQMuCtu5hYVa8TJ1IYKS6wHv8cteoaHuAMVjmAgfx6Zzq+4BbuaZc2oss5lnesGczxcxRyGJ3hqxLdeHt6lYAuXv0s+o3GJSVASuAM2wDtJv/tSWeeCnLR4LUkCn5kdqW1aS/+TJB6etr+vDl/gDD3ObEsZgP15klPEBZRfsKkz7Bs8hDLEDMULTl+b5Hfv+ccR8tZsBx7nObz9kcfFzJfZAXEN5QCOdEi4jPJDEONGK/07SKAgYVZQTqq0M+vwhXwXfrVCfVPVSWFdPSj94h61Hd/sjVsWzHvLMJPjSivrd+G5OYgpXE9wbvTlBCeTEuEqlvcbKRe4Ax/DE4RLaV9q3qvwrBzdWI/sn0e1XenYplsEYzXL/x6UHWYNu+SyDc+SMvymiPEUZQO24llpFcANpAz2Eo9oMrXNJv3oi3kjj+Wf+RNcQuqYAVa0FTJNf0VuTLZh4gkcFYbp3pv4I6eXDykS/lh843O+gU/CDg0VlA71g/Cfu0jmg7kXWegLwLlJR/5dcxj3p2icteFEc1jEU9cegU0it40ZfBp3iKrP7a98FdV80hcQDEy5932NFd0B+2O8PXXC3kTaAqLBXyklNGM/V8CrrA/+IBpOhRHwRFodjDPtYmqa+NBULENUBAFnptmEuZaWxBwmP2AOJCqQAFkFfII/0zlKceiS4V4Rb/5F7QssQFDVkyvDlbGVOYzvR5P7SDXr0Hwa+qBZBDqKqIgCBKji25wixgTd5n9ga3nqBt2KL0BeZvG+w+PZ8wVcqVBn6gsQBN34ZcvflHg/x1WCDyeJys4RvSWmpqoTPnO2wfhH+6KiIUEhfYEZZXXzviEiHrv0i2E1kY4EhfQFOEP6CIaT3IOyO4Fxpn76NnXd5U0dh5A8Nuq6E2lJUEhfwLcKT3eTLOMSNURaEhTSF/CWwtOrxD+LNbAmkZYEhfQFiRrh63vCMyLAQURqEhTSl4WnPAusjjOeIdKToJC+XMaiEUzYXpYSw7toS5DpK06hcZQYZoU5gEhHgkL6gnA92bkgIuuI/ress4oEmb4CuFx4fZCIcKj1tE5UCHWmTF8D/tmRaayHVWNMM8tqStBK3+wuH3W4sjUwC2x0MFxLglb6QTera/H3gv4pj8QMKQHfh2UaErTSpzZ2z8Kcv3hwznL983rBABUfd+tnJvdf4rrA3zp/VXVu0I2KTllnftTODtctrTDO09y/b+N9uSsVhQWP9iD+w5HZpIY+VnN1we3ftml4CDskDI8snJRYjyCGTflGjHPnZPaJavGWvt1NbszeYhRK0vB2VKN9U0wu8fQ/qOtLUXAcv5Rw+renUalxVxzPY0sw/d95kwwObnM0/11CT34Gn5NxlVzXEXvJA64o9h1fZUZRtjRU8M58Fd7BzMJPGdxu9nGXlR6Px+PxeDwej8fTCuqT0t87aXJ3AAAAAElFTkSuQmCC);
        display: inline-block;
        width: 24px;
        height: 24px;
        background-repeat: no-repeat;
        background-size: contain;
      }
    </style>
  </head>
  <body>
    <div style="margin-top: 25vh">
      <h3>Scraper</h3>
      <i>Sponsored by Public Forum Debate</i>
      <div>
        <input id="search-box" style="width: 250px; height: 20px; margin: 20px; padding: 10px; transition-duration: 250ms;" placeholder="Keyword"></input>
        <br>
        <input type="checkbox" id="docs">
        <label for="docs">Show Empty Documents</label>
      </div>
      <div id="results">
      
      </div>
    </div>
    <script>
      const resultElem = document.getElementById("results");
      const resultTemplate = (school, caseName, report, doc) => `
        <h4>${school} / ${caseName}</h4>
        <p style="max-height: 250px; overflow-y: auto;">${report}</p>
        <a class="${doc.trim() === ""? "disabled": ""}" href="${doc || ""}" title="Download document"><i class="download"></i></a>
      `;
    
      let timeouts = [];
      
      window.onload = () => document.getElementById("search-box").onkeypress = function(e) {
        if(e.keyCode === 13){
          if(this.value === "")return;
          while(resultElem.firstChild) {
            resultElem.removeChild(resultElem.firstChild);
          }
          timeouts.forEach(timeout => clearTimeout(timeout));
          timeouts = [];
          
          const settings = {
            showEmpty: document.getElementById("docs").checked
          }
          
          const httpRequest = new XMLHttpRequest();
          httpRequest.onreadystatechange = () => {
            if (httpRequest.readyState === 4 && httpRequest.status === 200) {
              const items = JSON.parse(httpRequest.responseText)
                .filter(item => item.document.trim() !== "" || settings.showEmpty)
                .map(({team, case_name, report, document}) => resultTemplate(team, case_name, report, document));
                
          
              resultElem.insertAdjacentHTML("beforeend", `<i>${items.length} results found</i>`);
              items.forEach((html, i) => timeouts.push(setTimeout(() => resultElem.insertAdjacentHTML("beforeend", html), 10 * i)));
              
              this.value = "";
            }
          };
          httpRequest.open('GET', `/search?term=${encodeURIComponent(this.value)}`);
          httpRequest.send();           
        }
      }
    </script>
  </body>
</html>
